// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           String   @id @default(uuid())
  name         String   @unique
  passwordHash String
  role         Role     @default(Viewer)
  groups       Group[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Group {
  id        String    @id @default(uuid())
  name      String    @unique
  users     User[]
  libraries Library[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Library {
  id          String       @id @default(uuid())
  name        String
  path        String       // Filesystem path where media is stored
  libraryType LibraryType
  groups      Group[]      // Groups that can access this library
  collections Collection[] // Collections within this library
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Collection {
  id        String   @id @default(uuid())
  name      String

  // Belongs to a library
  library   Library  @relation(fields: [libraryId], references: [id], onDelete: Cascade)
  libraryId String

  // Self-referential hierarchy: a collection can have a parent collection
  parent    Collection?  @relation("CollectionHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  parentId  String?
  children  Collection[] @relation("CollectionHierarchy")

  // Media within this collection
  media     Media[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([libraryId])
  @@index([parentId])
}

enum LibraryType {
  Television
  Film
  Music
}

enum Role {
  Admin    // Full access: manage users, settings, all content and actions
  Editor   // Can create, edit, and delete content
  Viewer   // Read-only access to content
}

// Single Table Inheritance (STI) model for Media
model Media {
  id          String    @id @default(uuid())

  // Shared properties for both Video and Audio
  path        String    // File location/path
  duration    Int       // Length in seconds
  name        String    // Human-readable name
  description String    // Description text

  // Discriminator field
  type        MediaType

  // Belongs to a collection
  collection   Collection? @relation(fields: [collectionId], references: [id], onDelete: SetNull)
  collectionId String?

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([type])
  @@index([collectionId])
}

enum MediaType {
  Video
  Audio
}

// Settings model for system-wide configuration
// This should be a singleton table with only one row
model Settings {
  id           String   @id @default(uuid())
  instanceName String   // Main name of the instance
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
